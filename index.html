<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <title>Knee Recovery Fitness Tracker</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }
        
        .app-container {
            max-width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: calc(100vh - 20px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .deployment-status {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .nav-tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 15px;
            background: #f1f3f4;
            padding: 5px;
            overflow-x: auto;
        }
        
        .nav-tab {
            flex: 1;
            min-width: 80px;
            padding: 12px 8px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.85em;
            white-space: nowrap;
            user-select: none;
        }
        
        .nav-tab.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }
        
        .nav-tab:not(.active) {
            color: #666;
        }
        
        .nav-tab:hover:not(.active) {
            background: #e9ecef;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .workout-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-left: 5px solid #e74c3c;
        }
        
        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .workout-title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .workout-status {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
            font-size: 1em;
            user-select: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 0.85em;
            width: auto;
            margin-right: 10px;
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-direction: column;
            padding: 2px;
        }
        
        .calendar-day.workout-completed {
            background: #28a745;
            color: white;
        }
        
        .calendar-day.basketball-day {
            background: #e74c3c;
            color: white;
        }
        
        .calendar-day.today {
            border: 2px solid #667eea;
            font-weight: bold;
        }
        
        .exercise-list {
            margin-top: 10px;
        }
        
        .exercise-item {
            display: flex;
            align-items: flex-start;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        
        .exercise-item:hover {
            background: #e9ecef;
        }
        
        .exercise-checkbox {
            margin-right: 10px;
            margin-top: 3px;
            transform: scale(1.2);
            cursor: pointer;
        }
        
        .knee-pain-scale {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .pain-level {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .pain-level:hover {
            border-color: #667eea;
        }
        
        .pain-level.selected {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }
        
        .meal-timing-critical {
            background: #fff3cd !important;
            border-left: 3px solid #f39c12 !important;
        }
        
        .meal-timing-recovery {
            background: #d4edda !important;
            border-left: 3px solid #28a745 !important;
        }
        
        .meal-timing-basketball {
            background: #f8d7da !important;
            border-left: 3px solid #dc3545 !important;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
            display: none;
        }
        
        @media (max-width: 480px) {
            .app-container {
                padding: 15px;
                border-radius: 15px;
            }
            
            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .nav-tab {
                font-size: 0.75em;
                padding: 10px 6px;
            }
            
            .workout-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .knee-pain-scale {
                justify-content: center;
            }
            
            .pain-level {
                width: 30px;
                height: 30px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>🏀 Fitness Recovery Tracker</h1>
            <p>Knee Recovery • Weight Loss • Triathlon Prep</p>
        </div>
        
        <div class="deployment-status">
            <h3>✅ App Successfully Deployed!</h3>
            <p>All features are working. Bookmark this page or add to home screen!</p>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="dashboard">📊 Dashboard</div>
            <div class="nav-tab" data-tab="workouts">💪 Workouts</div>
            <div class="nav-tab" data-tab="progress">📈 Progress</div>
            <div class="nav-tab" data-tab="nutrition">🍎 Nutrition</div>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-value" id="currentWeight">--</div>
                    <div class="stat-label">Current Weight (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="weightLoss">--</div>
                    <div class="stat-label">Weight Lost (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="workoutsWeek">0</div>
                    <div class="stat-label">Workouts This Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="currentWeek">1</div>
                    <div class="stat-label">Program Week</div>
                </div>
            </div>
            
            <div class="workout-card">
                <div class="workout-header">
                    <div class="workout-title">Today's Plan: <span id="todayPlan">Loading...</span></div>
                    <div class="workout-status status-pending" id="todayStatus">PENDING</div>
                </div>
                <div id="todayDetails">Loading today's workout...</div>
                <button class="btn" id="markCompleteBtn">✅ Mark Complete</button>
                <div class="success-message" id="successMessage">Great job! Today's workout completed! 🎉</div>
            </div>
            
            <div class="workout-card">
                <h3>🗓️ This Week's Schedule</h3>
                <div class="calendar-grid" id="weekCalendar"></div>
            </div>
            
            <div class="workout-card">
                <h3>🦵 Knee Health Check</h3>
                <div class="input-group">
                    <label class="input-label">Rate your knee pain today (0 = no pain, 10 = severe):</label>
                    <div class="knee-pain-scale" id="painScale"></div>
                </div>
                <button class="btn btn-small" id="logPainBtn">Log Pain Level</button>
                <div class="success-message" id="painSuccessMessage">Pain level logged successfully!</div>
            </div>
        </div>
        
        <!-- Workouts Tab -->
        <div id="workouts" class="tab-content">
            <div class="workout-card">
                <h3>🚴‍♂️ Cardio Workouts (After Work 5:30pm)</h3>
                <div class="exercise-list">
                    <div class="exercise-item">
                        <input type="checkbox" class="exercise-checkbox" id="bike-workout">
                        <div>
                            <strong>Stationary Bike</strong><br>
                            <small>Week 1-2: 20-25min | Week 3-4: 30-35min | Week 5+: 40-50min</small>
                        </div>
                    </div>
                    <div class="exercise-item">
                        <input type="checkbox" class="exercise-checkbox" id="rowing-workout">
                        <div>
                            <strong>Rowing Machine</strong><br>
                            <small>Week 1-2: 15-20min | Week 3-4: 25-30min | Week 5+: 35min</small>
                        </div>
                    </div>
                    <div class="exercise-item">
                        <input type="checkbox" class="exercise-checkbox" id="treadmill-workout">
                        <div>
                            <strong>Incline Treadmill Walk</strong><br>
                            <small>Week 1-2: 20min | Week 3-4: 30min | Week 5+: 40min</small>
                        </div>
                    </div>
                    <div class="exercise-item">
                        <input type="checkbox" class="exercise-checkbox" id="elliptical-workout">
                        <div>
                            <strong>Cross Trainer/Elliptical</strong><br>
                            <small>Week 1-2: 20-25min | Week 3-4: 30-35min | Week 5+: 40min</small>
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Duration (minutes):</label>
                    <input type="number" class="input-field" id="workoutDuration" placeholder="30" min="1" max="120">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Intensity (1-10):</label>
                    <input type="number" class="input-field" id="workoutIntensity" min="1" max="10" placeholder="6">
                </div>
                
                <button class="btn" id="logWorkoutBtn">📝 Log Workout</button>
                <div class="success-message" id="workoutSuccessMessage">Cardio workout logged successfully! 💪</div>
            </div>
            
            <div class="workout-card">
                <h3>💪 Strength Training</h3>
                <div class="exercise-list">
                    <div class="exercise-item">
                        <input type="checkbox" class="exercise-checkbox" id="leg-press">
                        <span>Leg Press (Knee-Safe) - 3 sets × 10-12</span>
                    </div>
                    <div class="exercise-item">
                        <input type="checkbox" class="exercise-checkbox" id="chest-press">
                        <span>Chest Press Machine - 3 sets × 10-12</span>
                    </div>
                    <div class="exercise-item">
                        <input type="checkbox" class="exercise-checkbox" id="seated-row">
                        <span>Seated Cable Row - 3 sets × 10-12</span>
                    </div>
                    <div class="exercise-item">
                        <input type="checkbox" class="exercise-checkbox" id="pull-ups">
                        <span>Assisted Pull-ups - 3 sets × 6-10</span>
                    </div>
                    <div class="exercise-item">
                        <input type="checkbox" class="exercise-checkbox" id="wall-sits">
                        <span>Wall Sits - 2 sets × 20-30 seconds</span>
                    </div>
                    <div class="exercise-item">
                        <input type="checkbox" class="exercise-checkbox" id="planks">
                        <span>Planks - 3 sets × 30-60 seconds</span>
                    </div>
                </div>
                <button class="btn" id="logStrengthBtn">📝 Log Strength Session</button>
                <div class="success-message" id="strengthSuccessMessage">Strength workout logged successfully! 💪</div>
            </div>
            
            <div class="workout-card" style="border-left-color: #e74c3c;">
                <h3>🏀 Basketball Sessions</h3>
                <p><strong>Mondays & Thursdays (8:40pm or 9:30pm)</strong></p>
                <div class="input-group">
                    <label class="input-label">Session Rating (1-10):</label>
                    <input type="number" class="input-field" id="basketballRating" min="1" max="10" placeholder="7">
                </div>
                <div class="input-group">
                    <label class="input-label">Knee comfort during play (1-10):</label>
                    <input type="number" class="input-field" id="basketballKnee" min="1" max="10" placeholder="8">
                </div>
                <button class="btn" id="logBasketballBtn">🏀 Log Basketball Session</button>
                <div class="success-message" id="basketballSuccessMessage">Basketball session logged! 🏀</div>
            </div>
        </div>
        
        <!-- Progress Tab -->
        <div id="progress" class="tab-content">
            <div class="input-group">
                <label class="input-label">Current Weight (kg):</label>
                <input type="number" class="input-field" id="weightInput" step="0.1" placeholder="85.0" min="40" max="200">
                <button class="btn btn-small" id="logWeightBtn">📊 Log Weight</button>
                <div class="success-message" id="weightSuccessMessage">Weight logged successfully! 📊</div>
            </div>
            
            <div class="workout-card">
                <h3>📈 Weight Progress</h3>
                <div id="weightProgressText">Enter your weight above to start tracking!</div>
            </div>
            
            <div class="workout-card">
                <h3>🦵 Knee Pain Tracking</h3>
                <div id="painProgressText">Log knee pain levels to track improvement!</div>
            </div>
            
            <div class="workout-card">
                <h3>💪 Weekly Workout Summary</h3>
                <div id="weeklyStats">Complete workouts to see your progress!</div>
            </div>
        </div>
        
        <!-- Nutrition Tab -->
        <div id="nutrition" class="tab-content">
            <div class="workout-card">
                <h3 id="mealPlanTitle">🥗 Today's Meal Plan</h3>
                <div class="exercise-list" id="todayMealPlan">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            
            <div class="workout-card">
                <h3>⏰ Critical Meal Timing</h3>
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <h4 style="color: #856404; margin: 0 0 10px 0;">🚨 KEY REMINDERS:</h4>
                    <ul style="color: #856404; margin: 0; padding-left: 20px;">
                        <li><strong>3:30pm Office Snack = Your Gym Fuel</strong></li>
                        <li><strong>Lunch = Biggest meal</strong> (fuels work + gym + basketball)</li>
                        <li><strong>Post-gym protein within 15 minutes</strong></li>
                        <li><strong>Basketball days:</strong> Extra carbs at 3:30pm</li>
                    </ul>
                </div>
            </div>
            
            <div class="workout-card">
                <h3>💧 Hydration Tracking</h3>
                <div class="input-group">
                    <label class="input-label">Water intake (glasses):</label>
                    <input type="number" class="input-field" id="waterIntake" min="0" max="20" placeholder="8">
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="hydrationProgress" style="width: 0%"></div>
                </div>
                <p id="hydrationText">Target: 8-10 glasses per day</p>
                <button class="btn btn-small" id="logHydrationBtn">💧 Log Water</button>
                <div class="success-message" id="hydrationSuccessMessage">Hydration logged! 💧</div>
            </div>
        </div>
    </div>

    <script>
        // App state
        let appData = {
            weights: [],
            painLevels: [],
            workouts: [],
            basketballSessions: [],
            meals: {},
            hydration: {},
            settings: {
                startWeight: null,
                targetWeight: null,
                startDate: new Date().toISOString().split('T')[0]
            },
            selectedPainLevel: null
        };

        // Meal plans for each day - After-work gym schedule
        const mealPlans = {
            0: { // Sunday - Meal Prep Day
                dayName: "Sunday - Meal Prep Day",
                meals: [
                    { time: "8:00am", name: "Power Breakfast", meal: "3 eggs + spinach + avocado", type: "normal" },
                    { time: "11:00am", name: "Mid-Morning", meal: "Greek yogurt + berries + almonds", type: "normal" },
                    { time: "1:00pm", name: "Lunch (Biggest)", meal: "Chicken + quinoa + roasted vegetables", type: "normal" },
                    { time: "4:00pm", name: "Afternoon Snack", meal: "Apple + almond butter", type: "normal" },
                    { time: "7:00pm", name: "Light Dinner", meal: "Salmon + large salad + small sweet potato", type: "normal" }
                ]
            },
            1: { // Monday - Basketball Day 🏀
                dayName: "Monday - Basketball Day 🏀",
                meals: [
                    { time: "6:30am", name: "Wake-Up Fuel", meal: "2 eggs + toast + banana + coffee", type: "normal" },
                    { time: "10:00am", name: "Mid-Morning", meal: "Greek yogurt + berries", type: "normal" },
                    { time: "12:30pm", name: "LARGE Lunch", meal: "Chicken + brown rice + vegetables + avocado", type: "normal" },
                    { time: "3:30pm", name: "PRE-GYM FUEL", meal: "Banana + Greek yogurt + honey", type: "critical" },
                    { time: "6:45pm", name: "Post-Gym", meal: "Protein shake + berries", type: "recovery" },
                    { time: "8:00pm", name: "Friday Dinner", meal: "Grilled chicken + large salad + sweet potato", type: "normal" }
                ]
            },
            6: { // Saturday - Long Gym Day 🔥
                dayName: "Saturday - Long Gym Day 🔥",
                meals: [
                    { time: "8:00am", name: "Weekend Breakfast", meal: "Protein smoothie bowl + oats + berries + nuts", type: "normal" },
                    { time: "11:00am", name: "Pre-Long Workout", meal: "Banana + almond butter + coffee", type: "critical" },
                    { time: "1:45pm", name: "Post-Long Workout", meal: "LARGE protein smoothie + Greek yogurt + berries", type: "recovery" },
                    { time: "3:00pm", name: "Recovery Meal", meal: "Salmon + quinoa + roasted vegetables + avocado", type: "normal" },
                    { time: "8:00pm", name: "Relaxed Dinner", meal: "Whatever you fancy (you've earned it!)", type: "normal" }
                ]
            }
        };

        // Weekly schedule for after-work gym
        const weeklySchedule = {
            0: { type: 'rest', name: 'Meal Prep Day', details: 'Active recovery + prepare for week' },
            1: { type: 'basketball', name: 'Gym + Basketball', details: 'Work → Gym (5:30pm) → Basketball (8:40/9:30pm)' },
            2: { type: 'gym', name: 'Upper Body + Cardio', details: 'Work → Gym (5:30pm) → Home (7pm)' },
            3: { type: 'gym', name: 'Low-Impact Cardio', details: 'Work → Gym (5:30pm) → Home (7pm)' },
            4: { type: 'basketball', name: 'Gym + Basketball', details: 'Work → Gym (5:30pm) → Basketball (8:40/9:30pm)' },
            5: { type: 'gym', name: 'Full Body Strength', details: 'Work → Gym (5:30pm) → Home (7pm)' },
            6: { type: 'gym', name: 'Long Cardio + Sauna', details: 'Extended session (12-1:30pm) + recovery' }
        };

        // Initialize app
        function initApp() {
            console.log('Initializing app...');
            loadData();
            setupEventListeners();
            updateDashboard();
            createPainScale();
            updateMealPlan();
            console.log('App initialized successfully');
        }

        // Tab navigation
        function showTab(tabName) {
            console.log('Switching to tab:', tabName);
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            const targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // Add active class to clicked nav tab
            const activeNavTab = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeNavTab) {
                activeNavTab.classList.add('active');
            }
        }

        // Create pain scale
        function createPainScale() {
            const painScale = document.getElementById('painScale');
            if (!painScale) return;
            
            painScale.innerHTML = '';
            
            for (let i = 0; i <= 10; i++) {
                const painLevel = document.createElement('div');
                painLevel.className = 'pain-level';
                painLevel.textContent = i;
                painLevel.addEventListener('click', () => selectPainLevel(i));
                painScale.appendChild(painLevel);
            }
        }

        // Select pain level
        function selectPainLevel(level) {
            document.querySelectorAll('.pain-level').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Find and select the clicked level
            const painLevels = document.querySelectorAll('.pain-level');
            if (painLevels[level]) {
                painLevels[level].classList.add('selected');
                appData.selectedPainLevel = level;
            }
        }

        // Update dashboard
        function updateDashboard() {
            // Update stats
            const currentWeight = appData.weights.length > 0 ? 
                appData.weights[appData.weights.length - 1].weight : '--';
            const currentWeightEl = document.getElementById('currentWeight');
            if (currentWeightEl) currentWeightEl.textContent = currentWeight;
            
            const weightLoss = appData.settings.startWeight && currentWeight !== '--' ? 
                (appData.settings.startWeight - currentWeight).toFixed(1) : '--';
            const weightLossEl = document.getElementById('weightLoss');
            if (weightLossEl) weightLossEl.textContent = weightLoss;
            
            const workoutsThisWeek = getWorkoutsThisWeek();
            const workoutsWeekEl = document.getElementById('workoutsWeek');
            if (workoutsWeekEl) workoutsWeekEl.textContent = workoutsThisWeek;
            
            const currentWeek = getCurrentProgramWeek();
            const currentWeekEl = document.getElementById('currentWeek');
            if (currentWeekEl) currentWeekEl.textContent = currentWeek;
            
            // Update today's plan
            const today = new Date().getDay();
            const todayPlan = weeklySchedule[today];
            const todayPlanEl = document.getElementById('todayPlan');
            const todayDetailsEl = document.getElementById('todayDetails');
            if (todayPlanEl) todayPlanEl.textContent = todayPlan.name;
            if (todayDetailsEl) todayDetailsEl.textContent = todayPlan.details;
            
            // Update weekly calendar
            updateWeeklyCalendar();
        }

        // Get workouts this week
        function getWorkoutsThisWeek() {
            const today = new Date();
            const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay()));
            const workoutsThisWeek = appData.workouts.filter(workout => {
                const workoutDate = new Date(workout.date);
                return workoutDate >= startOfWeek;
            });
            return workoutsThisWeek.length;
        }

        // Get current program week
        function getCurrentProgramWeek() {
            if (!appData.settings.startDate) return 1;
            
            const startDate = new Date(appData.settings.startDate);
            const today = new Date();
            const diffTime = Math.abs(today - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const week = Math.ceil(diffDays / 7);
            
            return Math.min(Math.max(week, 1), 16); // Between 1 and 16 weeks
        }

        // Update weekly calendar
        function updateWeeklyCalendar() {
            const calendar = document.getElementById('weekCalendar');
            if (!calendar) return;
            
            calendar.innerHTML = '';
            
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const today = new Date();
            const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay()));
            
            for (let i = 0; i < 7; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const currentDay = new Date(startOfWeek);
                currentDay.setDate(startOfWeek.getDate() + i);
                
                const dayName = days[i];
                const dayNumber = currentDay.getDate();
                
                dayElement.innerHTML = `<div>${dayName}</div><div>${dayNumber}</div>`;
                
                // Check if today
                if (currentDay.toDateString() === new Date().toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // Check workout type
                const schedule = weeklySchedule[i];
                if (schedule.type === 'basketball') {
                    dayElement.classList.add('basketball-day');
                } else if (schedule.type === 'gym') {
                    // Check if workout completed
                    const workoutCompleted = appData.workouts.some(workout => 
                        new Date(workout.date).toDateString() === currentDay.toDateString()
                    );
                    if (workoutCompleted) {
                        dayElement.classList.add('workout-completed');
                    }
                }
                
                calendar.appendChild(dayElement);
            }
        }

        // Update meal plan
        function updateMealPlan() {
            const today = new Date().getDay();
            const todayMeals = mealPlans[today];
            const mealPlanTitle = document.getElementById('mealPlanTitle');
            const todayMealPlan = document.getElementById('todayMealPlan');
            
            if (!todayMeals || !todayMealPlan) return;
            
            if (mealPlanTitle) {
                mealPlanTitle.textContent = `🥗 ${todayMeals.dayName}`;
            }
            
            todayMealPlan.innerHTML = '';
            
            todayMeals.meals.forEach((meal, index) => {
                const mealElement = document.createElement('div');
                mealElement.className = 'exercise-item';
                
                // Add special styling based on meal type
                if (meal.type === 'critical') {
                    mealElement.classList.add('meal-timing-critical');
                } else if (meal.type === 'recovery') {
                    mealElement.classList.add('meal-timing-recovery');
                } else if (meal.type === 'basketball') {
                    mealElement.classList.add('meal-timing-basketball');
                }
                
                const mealId = `meal-${today}-${index}`;
                
                mealElement.innerHTML = `
                    <input type="checkbox" class="exercise-checkbox" id="${mealId}">
                    <div>
                        <strong>${meal.time} - ${meal.name}:</strong><br>
                        <span>${meal.meal}</span>
                    </div>
                `;
                
                todayMealPlan.appendChild(mealElement);
            });
            
            // Setup meal checkbox listeners
            setupMealEventListeners();
        }

        // Setup meal event listeners
        function setupMealEventListeners() {
            document.querySelectorAll('#nutrition .exercise-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const today = new Date().toDateString();
                    if (!appData.meals[today]) {
                        appData.meals[today] = {};
                    }
                    appData.meals[today][this.id] = this.checked;
                    saveData();
                });
            });
            
            // Load meal checkbox states
            const today = new Date().toDateString();
            if (appData.meals[today]) {
                Object.keys(appData.meals[today]).forEach(mealId => {
                    const checkbox = document.getElementById(mealId);
                    if (checkbox && typeof appData.meals[today][mealId] === 'boolean') {
                        checkbox.checked = appData.meals[today][mealId];
                    }
                });
            }
        }

        // Show success message
        function showSuccessMessage(messageId, text) {
            const messageEl = document.getElementById(messageId);
            if (messageEl) {
                if (text) messageEl.textContent = text;
                messageEl.style.display = 'block';
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, 3000);
            }
        }

        // Event handlers
        function markTodayComplete() {
            const today = new Date().toDateString();
            const todayWorkout = {
                date: today,
                type: 'general',
                completed: true
            };
            
            // Check if already logged today
            const existingWorkout = appData.workouts.find(w => w.date === today);
            if (existingWorkout) {
                showSuccessMessage('successMessage', 'Workout already logged for today!');
                return;
            }
            
            appData.workouts.push(todayWorkout);
            saveData();
            updateDashboard();
            showSuccessMessage('successMessage');
        }

        function logKneePain() {
            if (appData.selectedPainLevel === null || appData.selectedPainLevel === undefined) {
                alert('Please select a pain level first');
                return;
            }
            
            const today = new Date().toDateString();
            appData.painLevels.push({
                date: today,
                level: appData.selectedPainLevel
            });
            
            saveData();
            showSuccessMessage('painSuccessMessage', `Knee pain level ${appData.selectedPainLevel} logged for today`);
            appData.selectedPainLevel = null;
            createPainScale();
            updateProgressTab();
        }

        function logWorkout() {
            const duration = document.getElementById('workoutDuration').value;
            const intensity = document.getElementById('workoutIntensity').value;
            
            if (!duration || !intensity) {
                alert('Please fill in duration and intensity');
                return;
            }
            
            const exercises = [];
            document.querySelectorAll('#workouts .exercise-checkbox:checked').forEach(checkbox => {
                exercises.push(checkbox.id);
            });
            
            const workout = {
                date: new Date().toDateString(),
                type: 'cardio',
                duration: parseInt(duration),
                intensity: parseInt(intensity),
                exercises: exercises
            };
            
            appData.workouts.push(workout);
            saveData();
            
            // Clear form
            document.getElementById('workoutDuration').value = '';
            document.getElementById('workoutIntensity').value = '';
            document.querySelectorAll('#workouts .exercise-checkbox').forEach(cb => cb.checked = false);
            
            updateDashboard();
            updateProgressTab();
            showSuccessMessage('workoutSuccessMessage');
        }

        function logStrengthWorkout() {
            const exercises = [];
            document.querySelectorAll('#workouts .exercise-checkbox:checked').forEach(checkbox => {
                exercises.push(checkbox.id);
            });
            
            if (exercises.length === 0) {
                alert('Please select at least one exercise');
                return;
            }
            
            const workout = {
                date: new Date().toDateString(),
                type: 'strength',
                exercises: exercises
            };
            
            appData.workouts.push(workout);
            saveData();
            
            // Clear checkboxes
            document.querySelectorAll('#workouts .exercise-checkbox').forEach(cb => cb.checked = false);
            
            updateDashboard();
            updateProgressTab();
            showSuccessMessage('strengthSuccessMessage');
        }

        function logBasketball() {
            const rating = document.getElementById('basketballRating').value;
            const kneeComfort = document.getElementById('basketballKnee').value;
            
            if (!rating || !kneeComfort) {
                alert('Please fill in both ratings');
                return;
            }
            
            const session = {
                date: new Date().toDateString(),
                rating: parseInt(rating),
                kneeComfort: parseInt(kneeComfort)
            };
            
            appData.basketballSessions.push(session);
            saveData();
            
            // Clear form
            document.getElementById('basketballRating').value = '';
            document.getElementById('basketballKnee').value = '';
            
            updateProgressTab();
            showSuccessMessage('basketballSuccessMessage');
        }

        function logWeight() {
            const weight = document.getElementById('weightInput').value;
            
            if (!weight) {
                alert('Please enter your weight');
                return;
            }
            
            const today = new Date().toDateString();
            
            // Check if weight already logged today
            const existingWeight = appData.weights.find(w => w.date === today);
            if (existingWeight) {
                existingWeight.weight = parseFloat(weight);
            } else {
                appData.weights.push({
                    date: today,
                    weight: parseFloat(weight)
                });
            }
            
            saveData();
            updateDashboard();
            updateProgressTab();
            
            document.getElementById('weightInput').value = '';
            showSuccessMessage('weightSuccessMessage');
        }

        function logHydration() {
            const waterIntake = document.getElementById('waterIntake').value;
            
            if (!waterIntake) {
                alert('Please enter water intake');
                return;
            }
            
            const today = new Date().toDateString();
            appData.hydration[today] = parseInt(waterIntake);
            
            const progress = Math.min((parseInt(waterIntake) / 8) * 100, 100);
            const hydrationProgress = document.getElementById('hydrationProgress');
            if (hydrationProgress) {
                hydrationProgress.style.width = progress + '%';
            }
            
            saveData();
            showSuccessMessage('hydrationSuccessMessage');
        }

        // Update progress tab
        function updateProgressTab() {
            // Weight progress
            if (appData.weights.length > 0) {
                const latestWeight = appData.weights[appData.weights.length - 1].weight;
                const startWeight = appData.settings.startWeight;
                
                const weightProgressText = document.getElementById('weightProgressText');
                if (weightProgressText) {
                    if (startWeight) {
                        const weightLoss = startWeight - latestWeight;
                        weightProgressText.innerHTML = 
                            `<strong>Weight Loss:</strong> ${weightLoss.toFixed(1)}kg<br>
                             <strong>Latest:</strong> ${latestWeight}kg<br>
                             <strong>Starting:</strong> ${startWeight}kg`;
                    } else {
                        weightProgressText.innerHTML = 
                            `<strong>Latest Weight:</strong> ${latestWeight}kg<br>
                             <em>Set your starting weight in settings to track progress</em>`;
                    }
                }
            }
            
            // Pain progress
            if (appData.painLevels.length > 0) {
                const latestPain = appData.painLevels[appData.painLevels.length - 1].level;
                const avgPain = appData.painLevels.reduce((sum, p) => sum + p.level, 0) / appData.painLevels.length;
                
                const painProgressText = document.getElementById('painProgressText');
                if (painProgressText) {
                    painProgressText.innerHTML = 
                        `<strong>Latest Pain Level:</strong> ${latestPain}/10<br>
                         <strong>Average:</strong> ${avgPain.toFixed(1)}/10<br>
                         <strong>Entries:</strong> ${appData.painLevels.length}`;
                }
            }
            
            // Weekly stats
            const totalWorkouts = appData.workouts.length;
            const basketballSessions = appData.basketballSessions.length;
            
            const weeklyStats = document.getElementById('weeklyStats');
            if (weeklyStats) {
                weeklyStats.innerHTML = 
                    `<strong>Total Workouts:</strong> ${totalWorkouts}<br>
                     <strong>Basketball Sessions:</strong> ${basketballSessions}<br>
                     <strong>This Week:</strong> ${getWorkoutsThisWeek()} workouts`;
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    if (tabName) {
                        showTab(tabName);
                    }
                });
            });

            // Button event listeners
            const markCompleteBtn = document.getElementById('markCompleteBtn');
            if (markCompleteBtn) markCompleteBtn.addEventListener('click', markTodayComplete);

            const logPainBtn = document.getElementById('logPainBtn');
            if (logPainBtn) logPainBtn.addEventListener('click', logKneePain);

            const logWorkoutBtn = document.getElementById('logWorkoutBtn');
            if (logWorkoutBtn) logWorkoutBtn.addEventListener('click', logWorkout);

            const logStrengthBtn = document.getElementById('logStrengthBtn');
            if (logStrengthBtn) logStrengthBtn.addEventListener('click', logStrengthWorkout);

            const logBasketballBtn = document.getElementById('logBasketballBtn');
            if (logBasketballBtn) logBasketballBtn.addEventListener('click', logBasketball);

            const logWeightBtn = document.getElementById('logWeightBtn');
            if (logWeightBtn) logWeightBtn.addEventListener('click', logWeight);

            const logHydrationBtn = document.getElementById('logHydrationBtn');
            if (logHydrationBtn) logHydrationBtn.addEventListener('click', logHydration);

            // Setup meal event listeners
            setupMealEventListeners();
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('fitnessTrackerData', JSON.stringify(appData));
                console.log('Data saved successfully');
            } catch (error) {
                console.log('Could not save to localStorage:', error);
            }
        }

        // Load data from localStorage
        function loadData() {
            try {
                const saved = localStorage.getItem('fitnessTrackerData');
                if (saved) {
                    const parsedData = JSON.parse(saved);
                    appData = { ...appData, ...parsedData };
                    console.log('Data loaded successfully');
                }
            } catch (error) {
                console.log('Could not load from localStorage:', error);
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing app...');
            initApp();
        });

        // Add these global functions for compatibility
        window.showTab = showTab;
        window.markTodayComplete = markTodayComplete;
        window.logKneePain = logKneePain;
        window.logWorkout = logWorkout;
        window.logStrengthWorkout = logStrengthWorkout;
        window.logBasketball = logBasketball;
        window.logWeight = logWeight;
        window.logHydration = logHydration;
    </script>
</body>
</html>Banana + almonds OR protein bar", type: "critical" },
                    { time: "6:45pm", name: "Post-Gym", meal: "Protein shake + banana", type: "recovery" },
                    { time: "7:30pm", name: "Pre-Basketball", meal: "Oats + honey OR turkey sandwich", type: "basketball" },
                    { time: "10:45pm", name: "Post-Game", meal: "Protein smoothie + berries", type: "recovery" }
                ]
            },
            2: { // Tuesday - Gym Day 💪
                dayName: "Tuesday - Gym Day 💪",
                meals: [
                    { time: "6:30am", name: "Energizing Breakfast", meal: "Overnight oats + protein powder + berries", type: "normal" },
                    { time: "10:00am", name: "Office Snack", meal: "Hard-boiled egg + cucumber", type: "normal" },
                    { time: "12:30pm", name: "Work Lunch", meal: "Turkey + avocado salad + quinoa", type: "normal" },
                    { time: "3:30pm", name: "PRE-GYM FUEL", meal: "Banana + almond butter", type: "critical" },
                    { time: "6:45pm", name: "Post-Gym", meal: "Protein shake + berries", type: "recovery" },
                    { time: "7:30pm", name: "Dinner", meal: "Salmon + broccoli + small sweet potato", type: "normal" }
                ]
            },
            3: { // Wednesday - Gym Day 🚴
                dayName: "Wednesday - Gym Day 🚴",
                meals: [
                    { time: "6:30am", name: "Protein Start", meal: "3 eggs + spinach + avocado + tomato", type: "normal" },
                    { time: "10:00am", name: "Mid-Morning", meal: "Cottage cheese + cucumber + tomatoes", type: "normal" },
                    { time: "12:30pm", name: "Balanced Lunch", meal: "Chicken + mixed salad + quinoa", type: "normal" },
                    { time: "3:30pm", name: "PRE-GYM FUEL", meal: "Banana + almonds", type: "critical" },
                    { time: "6:45pm", name: "Post-Gym", meal: "Protein smoothie + berries", type: "recovery" },
                    { time: "7:30pm", name: "Dinner", meal: "Beef stir-fry + vegetables + brown rice", type: "normal" }
                ]
            },
            4: { // Thursday - Basketball Day 🏀
                dayName: "Thursday - Basketball Day 🏀",
                meals: [
                    { time: "6:30am", name: "Substantial Breakfast", meal: "Protein pancakes (eggs + banana + protein)", type: "normal" },
                    { time: "10:00am", name: "Office Boost", meal: "Greek yogurt + almonds + berries", type: "normal" },
                    { time: "12:30pm", name: "LARGE Lunch", meal: "Salmon + sweet potato + salad + avocado", type: "normal" },
                    { time: "3:30pm", name: "PRE-GYM FUEL", meal: "Oats + banana + honey (MORE CARBS)", type: "critical" },
                    { time: "6:45pm", name: "Post-Gym", meal: "Protein shake + banana", type: "recovery" },
                    { time: "7:30pm", name: "Pre-Basketball", meal: "Oats + honey OR turkey wrap", type: "basketball" },
                    { time: "11:00pm", name: "Post-Game", meal: "Protein smoothie + berries", type: "recovery" }
                ]
            },
            5: { // Friday - Gym Day 🏋️
                dayName: "Friday - Gym Day 🏋️",
                meals: [
                    { time: "6:30am", name: "Weekend Ready", meal: "Veggie scramble (3 eggs + peppers + spinach)", type: "normal" },
                    { time: "10:00am", name: "Office Snack", meal: "Apple + almond butter", type: "normal" },
                    { time: "12:30pm", name: "Friday Lunch", meal: "Chicken + quinoa bowl + vegetables", type: "normal" },
                    { time: "3:30pm", name: "PRE-GYM FUEL", meal: "